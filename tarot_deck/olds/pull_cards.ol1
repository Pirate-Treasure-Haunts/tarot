import random
import json
import os

def load_deck():
    with open("deck_data.json", "r", encoding="utf-8") as f:
        return json.load(f)

def get_full_deck():
    deck = load_deck()
    full = []
    for tier, cards in deck.items():
        for card in cards:
            full.append({
                "tier": tier,
                "name": card["name"],
                "short": card.get("short", ""),
                "long": card.get("long", "")
            })
    return full

def draw_cards(n, already_drawn):
    available = [c for c in get_full_deck() if c["name"] not in already_drawn]
    if len(available) < n:
        print(f"\nâš ï¸ Only {len(available)} cards left to draw.")
        n = len(available)
    selected = random.sample(available, n)
    return selected

def print_card(card, detail="short"):
    print(f"\nðŸŽ´ {card['tier'].upper()} â€” {card['name']}")
    print("-" * (len(card['tier']) + len(card['name']) + 6))
    print(card[detail])
    print()

def main():
    print("ðŸ”® Welcome to the Alchemical Tarot of the Human Condition ðŸ”®\n")
    drawn_names = []

    while True:
        try:
            n = int(input("How many cards would you like to draw? (1â€“10): "))
            if not 1 <= n <= 10:
                raise ValueError()
        except ValueError:
            print("Please enter a valid number between 1 and 10.")
            continue

        detail_level = input("Show [s]hort or [l]ong descriptions? (s/l): ").strip().lower()
        if detail_level not in ["s", "l"]:
            detail_level = "s"

        drawn = draw_cards(n, drawn_names)
        if not drawn:
            print("\nðŸƒ All cards have been drawn! Starting fresh.\n")
            drawn_names.clear()
            continue

        for card in drawn:
            print_card(card, detail="short" if detail_level == "s" else "long")
            drawn_names.append(card["name"])

        again = input("Draw again? (y = continue, f = fresh deck, n = quit): ").strip().lower()
        if again == "f":
            drawn_names.clear()
            print("\nðŸ” Deck reset. Starting anew.\n")
        elif again != "y":
            print("\nFarewell, seeker. May the archetypes guide you well.")
            break

if __name__ == "__main__":
    main()